<app-form-header></app-form-header>
<div class="logo-container">
  <img src="assets/cs-logo.png">
</div>
<div class="title-container">
  <div>Request subbmision</div>
</div>
<mat-spinner class="custom-spinner" *ngIf="isLoading"></mat-spinner>
<form #requestForm="ngForm" 
      name="request-form" 
      class="form-container" 
      *ngIf="!isLoading"
      (ngSubmit)="onSubmit(requestForm)">
  <div class="form-group">
    <label class="input-label" for="fRequestName">Request name</label>
    <input required 
          [disabled]="isFormDisabled" 
          #fRequestName="ngModel" 
          maxlength="255" 
          name="fRequestName"
          [(ngModel)]="request.RequestName" 
          class="form-control short-text" 
          placeholder="Rats and brats">
    <div *ngIf="fRequestName.invalid && isFormSubmitted" class="input-label-invalid">Request name is required!</div>
  </div>
  <div class="row">
    <div class="col">
      <div class="form-group" #requestorGroup>
        <label>Requestor</label>
        <input required 
              [disabled]="isFormDisabled" 
              (keyup)="onRequestorType($event)" 
              #fRequestor="ngModel" 
              type="text"
              class="form-control short-text" 
              name="fRequestor" 
              [(ngModel)]="requestorDisplayName" 
              placeholder="Baba Yaga (DABA)">
        <div class="search-user-container" *ngIf="isRequestorSearchListVisible">
          <button type="button" class="user-btn transparent-btn" *ngFor="let user of requestorSearchResult"
            (click)="selectRequestor(user)">
            {{user.DisplayName}}
          </button>
        </div>
        <div *ngIf="fRequestor.invalid && isFormSubmitted" class="input-label-invalid">Requestor is required! Choose one
          from list.</div>
      </div>
    </div>
  </div>
  <div class="form-group radio-group">
    <label class="radios-label">Good ending {{isFormDisabled}}</label>
    <div class="form-check form-check-inline">
      <label class="good-ending form-check-label">Yes
        <input required 
              [attr.disabled]="isFormDisabled ? true : null" 
              class="form-check-input" 
              type="radio"
              name="fGoodEnding-Yes" 
              [(ngModel)]="request.GoodEnding" 
              value="Yes">
        <span class="checkmark radio"></span>
      </label>
    </div>
    <div class="form-check form-check-inline">
      <label class="good-ending form-check-label">Depends
        <input required
              [attr.disabled]="isFormDisabled ? true : null" 
              class="form-check-input"
              type="radio"
              name="fGoodEnding-Depends" 
              [(ngModel)]="request.GoodEnding" 
              value="Depends">
        <span class="checkmark radio"></span>
      </label>
    </div>
    <div class="form-check form-check-inline">
      <label class="good-ending form-check-label">No
        <input required 
              [attr.disabled]="isFormDisabled ? true : null" 
              class="form-check-input" 
              type="radio"
              name="fGoodEnding-No" 
              [(ngModel)]="request.GoodEnding" 
              value="No">
        <span class="checkmark radio"></span>
      </label>
    </div>
  </div>
  <div class="form-group">
    <label>Description</label>
    <textarea [disabled]="isFormDisabled" 
              (input)="onTextareaInput($event)" 
              [ngClass]="{'expanded':isTextareaExpanded}"
              minlength="250" 
              type="textarea" 
              #fDescription="ngModel" 
              name="fDescription" 
              [(ngModel)]="request.Description"
              class="form-control" 
              placeholder="Lorem ipsum lorem ipsum..."></textarea>
    <small class="form-text text-muted">No spoilers please</small>
    <div *ngIf="fDescription.invalid && isFormSubmitted" class="input-label-invalid">Description has to be at lest 250
      characters long!</div>
  </div>
  <div class="form-group">
    <div class="form-check form-check-inline">
      <label class="need-storyteler form-check-label">Need storyteller
        <input required 
              [disabled]="isFormDisabled" 
              #fNeedStoryteller="ngModel" 
              class="form-check-input" 
              type="checkbox"
              name="fNeedStoryteller" 
              [(ngModel)]="request.NeedStoryteller">
        <span class="checkmark"></span>
        <i class="fas fa-check checkmark "></i>
      </label>
    </div>
    <div *ngIf="fNeedStoryteller.invalid && isFormSubmitted" class="input-label-invalid">Need storyteller
      is required!</div>
  </div>
  <div class="form-group" *ngIf="request.NeedStoryteller">
    <label class="input-label" for="fRequestName">Storyteller</label>
    <input required 
          [disabled]="isFormDisabled" 
          #fStoryteller="ngModel" 
          name="fStoryteller"
          [(ngModel)]="request.Storyteller" 
          class="form-control short-text" 
          placeholder="Walt Disney">
    <div *ngIf="fStoryteller.invalid && isFormSubmitted" class="input-label-invalid">Storyteller is required!
    </div>
  </div>
  <div class="form-group">
    <label>Wanted characters</label>
    <app-cs-dropdown #csDropdown 
                    [disabled]="isFormDisabled" 
                    [data]="wantedCharacters"
                    [selectedItems]="this.request.WantedCharacters" 
                    (onDataChange)="onDataChange($event)">
    </app-cs-dropdown>
  </div>
  <div class="form-group">
    <label for="deadline">Deadline</label>
    <div class="input-group">
      <input readonly 
            [disabled]="isFormDisabled" 
            class="form-control" 
            name="fDeadline"
            [(ngModel)]="requestDeadlineString"
            (click)=deadlineInputClick($event)>
      <button type="button" class="icon-btn" [disabled]="isFormDisabled" (click)="openModal(modalContent)"><i
          class="fas fa-calendar"></i></button>
    </div>
  </div>
  <div class="row">
    <div class="col">
      <div class="form-group">
        <label>Budget</label>
        <input required 
              [csMinValue]="250000" 
              maxlength="15"
              [disabled]="isFormDisabled" 
              #fDeadline="ngModel" 
              type="number"
              name="fBudget" 
              [(ngModel)]="request.Budget"
              class="form-control short-text" 
              placeholder="250000">
        <small class="form-text text-muted">In Fable Dollars (FBD)</small>
        <div *ngIf="fDeadline.invalid && isFormSubmitted" class="input-label-invalid">Budget is required and has to be
          at least 250 000!</div>
      </div>
    </div>
    <div class="col">
      <div class="form-group">
        <label>Status</label>
        <input disabled type="text" name="fStatus" [(ngModel)]="request.Status" class="form-control short-text">
      </div>
    </div>
  </div>
  <div class="form-group action-buttons">
    <div class="action-button-container">
      <button type="button" routerLink="/dashboard" class="btn btn-cs-white cs-btn">Cancel</button>
      <button type="button" [disabled]="this.isFormDisabled" class="btn btn-cs-black cs-btn"
        (click)="saveButtonClik()">Save</button>
      <button type="submit" [disabled]="this.isFormDisabled" class="btn btn-cs-black cs-btn">Submit</button>
    </div>
  </div>
</form>
<app-form-footer></app-form-footer>

<ng-template #modalContent let-modal>
  <app-cs-calendar (close)="onDatePickerClosed($event)"></app-cs-calendar>
</ng-template>